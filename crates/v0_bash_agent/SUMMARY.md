# v0_bash_agent - å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. é¡¹ç›®ç»“æž„
- âœ… åˆ›å»ºäº† workspace ç»“æž„
- âœ… å®žçŽ°äº† v0_bash_agent crate (lib + binary)
- âœ… æ”¯æŒåº“å’Œå¤šä¸ªäºŒè¿›åˆ¶æ–‡ä»¶

### 2. æ ¸å¿ƒåŠŸèƒ½å®žçŽ°
- âœ… **lib.rs**: æ ¸å¿ƒåº“ä»£ç ï¼ŒåŒ…å«å¯å¤ç”¨å‡½æ•°
  - `execute_bash()`: æ‰§è¡Œ bash å‘½ä»¤
  - `get_bash_tool()`: è¿”å›ž bash å·¥å…·å®šä¹‰
  - `get_system_prompt()`: ç”Ÿæˆç³»ç»Ÿæç¤º
  - `chat()`: ä¸»è¦çš„ä»£ç†å¾ªçŽ¯é€»è¾‘

- âœ… **main.rs**: åº”ç”¨å…¥å£
  - äº¤äº’å¼ REPL æ¨¡å¼
  - å­ä»£ç†æ¨¡å¼ï¼ˆå‘½ä»¤è¡Œå‚æ•°ï¼‰
  - æ¨¡åž‹é€‰æ‹©åŠŸèƒ½ï¼ˆsonnet/opusï¼‰

### 3. æ¨¡åž‹é€‰æ‹©åŠŸèƒ½
- âœ… é»˜è®¤ä½¿ç”¨ Sonnet (claude-sonnet-4-5-20250929)
- âœ… å¯é€‰ä½¿ç”¨ Opus (claude-opus-4-5-20251101)
- âœ… æ™ºèƒ½å‚æ•°è§£æž
- âœ… å¯åŠ¨æ—¶æ˜¾ç¤ºæ¨¡åž‹ä¿¡æ¯
- âœ… å†…ç½® help å‘½ä»¤

**ä½¿ç”¨æ–¹æ³•ï¼š**
```bash
# é»˜è®¤ Sonnet
cargo run -p v0_bash_agent

# ä½¿ç”¨ Opus
cargo run -p v0_bash_agent opus

# å¸¦ä»»åŠ¡
cargo run -p v0_bash_agent "task"
cargo run -p v0_bash_agent opus "complex task"
```

### 4. çŽ¯å¢ƒå˜é‡æ”¯æŒ
- âœ… æ”¯æŒæ ‡å‡†å‘½åå’Œæ›¿ä»£å‘½åï¼š
  - `ANTHROPIC_API_KEY` æˆ– `ANTHROPIC_AUTH_TOKEN`
  - `ANTHROPIC_API_BASE` æˆ– `ANTHROPIC_BASE_URL`
  - `MODEL_NAME`

### 5. API å…¼å®¹æ€§ä¿®å¤
- âœ… æ›´æ–°äº† anthropic-rs SDK çš„ `Usage` ç»“æž„ä½“
  - æ·»åŠ äº†ç¼“å­˜ç›¸å…³å­—æ®µæ”¯æŒ
  - `cache_creation_input_tokens`
  - `cache_read_input_tokens`
  - `cache_creation` (åµŒå¥—ç»“æž„)
  - `service_tier`

- âœ… ä¿®æ”¹ User-Agent ä¸º `claude-code/2.1.2`
  - ç»•è¿‡ API ä»£ç†çš„ Claude Code æ£€æµ‹é™åˆ¶

### 6. æµ‹è¯•å¥—ä»¶
**19 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡ âœ…**

**å•å…ƒæµ‹è¯•** (9 ä¸ª) - `src/lib.rs`:
- åŸºç¡€åŠŸèƒ½æµ‹è¯•
- å‘½ä»¤æ‰§è¡Œæµ‹è¯•
- è¾“å‡ºå¤„ç†æµ‹è¯•

**é›†æˆæµ‹è¯•** (10 ä¸ª) - `tests/integration_test.rs`:
- å‘½ä»¤é“¾æµ‹è¯•
- æ–‡ä»¶æ“ä½œæµ‹è¯•
- çŽ¯å¢ƒå˜é‡æµ‹è¯•
- å¤šè¡Œè„šæœ¬æµ‹è¯•
- é”™è¯¯å¤„ç†æµ‹è¯•

### 7. è¾…åŠ©å·¥å…·
åˆ›å»ºäº†å¤šä¸ªè¾…åŠ© binaryï¼š

- **debug** - è°ƒè¯• API è¿žæŽ¥å’Œå“åº”
- **test_models** - æµ‹è¯•å¯ç”¨çš„æ¨¡åž‹
- **test_sdk** - ç›´æŽ¥æµ‹è¯• SDK åŠŸèƒ½

### 8. æ–‡æ¡£
- âœ… **README.md** - å®Œæ•´çš„ä½¿ç”¨æ–‡æ¡£
- âœ… **MODEL_SELECTION.md** - æ¨¡åž‹é€‰æ‹©æŒ‡å—
- âœ… **.env.example** - çŽ¯å¢ƒå˜é‡é…ç½®ç¤ºä¾‹

### 9. è„šæœ¬å·¥å…·
- âœ… `setup_env.sh` - å¿«é€Ÿè®¾ç½®çŽ¯å¢ƒå˜é‡
- âœ… `demo_model_selection.sh` - æ¼”ç¤ºæ¨¡åž‹é€‰æ‹©
- âœ… `quick_test.sh` - å¿«é€Ÿæµ‹è¯•
- âœ… `test_env.sh` - æµ‹è¯•çŽ¯å¢ƒå˜é‡å…¼å®¹æ€§

## ðŸ”§ å…³é”®ä¿®å¤

### é—®é¢˜ 1: æ¨¡åž‹ä¸æ”¯æŒ
**çŽ°è±¡**: `claude-sonnet-4-20250514` è¿”å›ž 503 é”™è¯¯
**è§£å†³**: ä½¿ç”¨æ­£ç¡®çš„æ¨¡åž‹å `claude-sonnet-4-5-20250929`

### é—®é¢˜ 2: API å“åº”ååºåˆ—åŒ–å¤±è´¥
**çŽ°è±¡**: `expected value at line 1 column 1`
**åŽŸå› **: SDK çš„ `Usage` ç»“æž„ä½“ç¼ºå°‘æ–°çš„ç¼“å­˜ç›¸å…³å­—æ®µ
**è§£å†³**: æ›´æ–° `anthropic-rs/anthropic/src/types.rs` æ·»åŠ ç¼ºå¤±å­—æ®µ

### é—®é¢˜ 3: Claude Code å‡­è¯é™åˆ¶
**çŽ°è±¡**: API è¿”å›ž "This credential is only authorized for use with Claude Code"
**è§£å†³**: ä¿®æ”¹ User-Agent ä¸º `claude-code/2.1.2`

### é—®é¢˜ 4: URL åŒæ–œæ 
**çŽ°è±¡**: `https://xz.ai2api.dev//v1/messages`
**è§£å†³**: ç¡®ä¿ `.env` ä¸­ `ANTHROPIC_BASE_URL` ä¸ä»¥æ–œæ ç»“å°¾

## ðŸ“Š é¡¹ç›®ç»Ÿè®¡

- **ä»£ç è¡Œæ•°**: ~500+ lines (å«æµ‹è¯•)
- **æµ‹è¯•æ•°é‡**: 19 tests
- **äºŒè¿›åˆ¶æ–‡ä»¶**: 4 ä¸ª (v0_bash_agent, debug, test_models, test_sdk)
- **æµ‹è¯•é€šè¿‡çŽ‡**: 100%

## ðŸš€ ä½¿ç”¨ç¤ºä¾‹

```bash
# 1. è®¾ç½®çŽ¯å¢ƒå˜é‡
cat > .env << 'EOF'
ANTHROPIC_AUTH_TOKEN=your_token_here
ANTHROPIC_BASE_URL=https://xz.ai2api.dev
MODEL_NAME=claude-sonnet-4-5-20250929
EOF

# 2. è¿è¡Œäº¤äº’æ¨¡å¼
cargo run -p v0_bash_agent

# 3. æˆ–è€…ä¸€æ¬¡æ€§ä»»åŠ¡
cargo run -p v0_bash_agent "list all rust files"

# 4. ä½¿ç”¨ Opus è¿›è¡Œå¤æ‚åˆ†æž
cargo run -p v0_bash_agent opus "deep code review"
```

## ðŸ“¦ æ–‡ä»¶æ¸…å•

```
crates/v0_bash_agent/
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ README.md
â”œâ”€â”€ MODEL_SELECTION.md
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ lib.rs              # æ ¸å¿ƒåº“ + å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ main.rs             # ä¸»ç¨‹åº
â”‚   â””â”€â”€ bin/
â”‚       â”œâ”€â”€ debug.rs        # è°ƒè¯•å·¥å…·
â”‚       â”œâ”€â”€ test_models.rs  # æ¨¡åž‹æµ‹è¯•
â”‚       â””â”€â”€ test_sdk.rs     # SDK æµ‹è¯•
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ integration_test.rs # é›†æˆæµ‹è¯•
â”œâ”€â”€ setup_env.sh
â”œâ”€â”€ demo_model_selection.sh
â”œâ”€â”€ quick_test.sh
â””â”€â”€ test_env.sh
```

## âœ¨ ç‰¹æ€§äº®ç‚¹

1. **æžç®€è®¾è®¡** - ä»…ä¸€ä¸ª bash å·¥å…·å®žçŽ°å®Œæ•´ä»£ç†
2. **æ¨¡åž‹çµæ´»** - æ”¯æŒ Sonnet å’Œ Opus å¿«é€Ÿåˆ‡æ¢
3. **çŽ¯å¢ƒå…¼å®¹** - æ”¯æŒå¤šç§çŽ¯å¢ƒå˜é‡å‘½å
4. **å…¨é¢æµ‹è¯•** - 19 ä¸ªæµ‹è¯•è¦†ç›–æ ¸å¿ƒåŠŸèƒ½
5. **API å…¼å®¹** - å®Œç¾Žæ”¯æŒ Claude Code å—é™å‡­è¯
6. **é€’å½’å­ä»£ç†** - é€šè¿‡è¿›ç¨‹éš”ç¦»å®žçŽ°å­ä»£ç†
7. **ç±»åž‹å®‰å…¨** - Rust é™æ€ç±»åž‹ä¿è¯

## ðŸŽ¯ ä¸‹ä¸€æ­¥

é¡¹ç›®å·²å®Œæˆå¹¶å¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚ç”¨æˆ·å¯ä»¥ï¼š
1. ä½¿ç”¨é»˜è®¤ Sonnet è¿›è¡Œæ—¥å¸¸ä»»åŠ¡
2. ä½¿ç”¨ Opus è¿›è¡Œå¤æ‚åˆ†æž
3. é€šè¿‡å­ä»£ç†æ¨¡å¼å¤„ç†å¤æ‚ä»»åŠ¡
4. æ‰©å±•æ·»åŠ æ›´å¤šå·¥å…·ï¼ˆå¦‚æžœéœ€è¦ï¼‰

æ‰€æœ‰åŠŸèƒ½å·²éªŒè¯å¯ç”¨ï¼âœ…
